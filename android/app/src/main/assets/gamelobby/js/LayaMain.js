var __assign=this&&this.__assign||function(){return(__assign=Object.assign||function(a){for(var e,t=1,o=arguments.length;t<o;t++)for(var n in e=arguments[t])Object.prototype.hasOwnProperty.call(e,n)&&(a[n]=e[n]);return a}).apply(this,arguments)},LayaMain=function(){function g(){this.sceneLobby=null,g.obj=this,Debug.isapp="true"==Tools.getQueryVariable("app"),"true"==Tools.getQueryVariable("isDebug")&&Debug.showVconsole(),Laya.init(0,Common.GM_SCREEN_H,Laya.WebGL),GameUtils.isNativeApp,UIConfig.closeDialogOnSide=!1,Laya.Dialog.manager.closeEffectHandler=new Laya.Handler(null,PageManager.closeDlg),Laya.Dialog.manager.popupEffectHandler=new Laya.Handler(null,PageManager.openDlg),Laya.stage.scaleMode=Laya.Stage.SCALE_FIXED_HEIGHT,Laya.stage.screenMode=Laya.Stage.SCREEN_HORIZONTAL,Laya.stage.bgColor="#000000",Laya.stage.on(Laya.Event.RESIZE,this,this.onResize),window.document.addEventListener("message",this.handleIFrameAction,!1),window.addEventListener("message",this.handleIFrameAction,!1),this.root_node=new Laya.Sprite,Laya.stage.addChild(this.root_node),SoundPlayer.initSoundSetting(),SaveManager.getObj().get("clearFlag",null)||(SaveManager.getObj().clearAll(),SaveManager.getObj().save("clearFlag","926")),PageManager.showPage(["res/atlas/ui/login.atlas","./assets/conf/assets_lobby.json","./assets/conf/gameIcons.json","./assets/conf/version.json"],LoginScene)}return g.getInstance=function(){return g.obj},g.prototype.onResize=function(a){ToolsApp.initAppData(),AppData.IS_NATIVE_APP&&(Laya.WorkerLoader.workerPath="libs/worker.js",Laya.WorkerLoader.enable=!0,AppData.NATIVE_DATA&&AppData.NATIVE_DATA.isNewApp?window.document.removeEventListener("message",this.handleIFrameAction,!1):window.removeEventListener("message",this.handleIFrameAction,!1)),PostMHelp.game_common({name:"onGameInit"})},g.prototype.getRootNode=function(){return this.root_node},g.prototype.handleAction=function(a){try{var e=JSON.parse(a.data);switch(Debug.log("handleAction:",e,e.action,a),e.action){case"lobbyResume":lamain.onGameResume()}}catch(a){}},g.prototype.loginOut=function(){PostMHelp.game_common({name:"loginout"}),SaveManager.getObj().save(SaveManager.KEY_TOKEN,""),Common.resetData(),this.clearChild(),PageManager.showPage(null,LoginScene)},g.prototype.onGamePause=function(){SoundPlayer.StopAllSounds(),SoundPlayer.initSoundSetting()},g.prototype.onGameResume=function(){SoundPlayer.CompatibleSetting(),EventManager.dispath(EventType.FLUSH_USERINFO)},g.prototype.handleIFrameAction=function(a){var e=a.data;g.getInstance().onAppPostMessgae(e)},g.prototype.onAppPostMessgae=function(a){var e=null;try{e=JSON.parse(a)}catch(a){Debug.error("onAppPostMessgae-err:",a)}if(e&&e.action)switch(e.action){case"wxLogin":0==LoginModel.weChatCertificationType?EventManager.dispath(EventType.WeChatLogin,e):1==LoginModel.weChatCertificationType&&EventManager.dispath(EventType.WeChatBind,e);break;case"logout":g.onQuit();break;case"playMusic":lamain.onGameResume();break;case"stopMusic":Laya.SoundManager.stopAll();break;case"windowResize":this.onResize("window-resize");break;case"appData":for(var t in e)null!=AppData[t]&&(Debug.log("appData->key=",t,null==AppData[t],e[t]),AppData[t]=e[t]);break;case"http":for(var o=0,n=HttpRequester.httpRequestList;o<n.length;o++){var s=n[o];if(s&&s.hashUrl==e.hashUrl){var i=HttpRequester.httpRequestList.indexOf(s);HttpRequester.httpRequestList.splice(i,1),GameUtils.clearTimeout(s.hashUrl);var r="";e.rs?(r=e.content,s.callback.apply(s.caller,[r,"complete",{http:__assign({},e,{response:r})}])):(r=JSON.stringify(e),s.callback.apply(s.caller,[e.message,"error",{http:__assign({},e,{response:r})}]))}}break;case"flushMoney":LobbyModel.inLobby&&LobbyModel.refreshMoney();break;case"openDebug":Debug.showVconsole();break;case"gamesinfo":UpdateMsgHandle.onInitMsg(e.data);break;case"updateProgress":UpdateMsgHandle.onUpdateMsg(e.data);break;case"setrawroot":UpdateMsgHandle.setRawRoot(e.data);break;case"playsound":UpdateMsgHandle.playSound(e.data);break;case"playmusic":UpdateMsgHandle.playMusic(e.data);break;case"onBlur":EventManager.dispath(EventType.BLUR_NATIVE),Laya.timer.once(300,this,function(){Laya.stage.event(Laya.Event.MOUSE_DOWN)});break;case"deviceInfo":MyUid.setUid(e.data);break;case"lobbyResume":GameData.joinLobbyType=JoinLobbyType.gameBank,LobbyModel.inLobby=!0,lamain.onGameResume(),EventManager.dispath(EventType.GAMETOHALL);break;case"enterGame":LobbyModel.inLobby=!1,EventManager.dispath(EventType.HALLTOGAME);break;case"showLoading":var l=e.alpha||0;this.showCircleLoading(Boolean(e.data),l);break;case"showMask":(p=Boolean(e.data))?(this.maskbg||(this.maskbg=new Laya.Sprite,this.maskbg.mouseEnabled=!0,this.maskbg.graphics.drawRect(0,0,Laya.stage.width,Laya.stage.height,"#000000"),this.maskbg.alpha=.6,this.maskbg.size(Laya.stage.width,Laya.stage.height),this.maskbg.zOrder=Dialog.manager.zOrder+1),Laya.stage.addChild(this.maskbg)):this.maskbg&&this.maskbg.removeSelf();break;case"lifecycle":1==e.data&&(GameData.joinLobbyType=JoinLobbyType.backstage),EventManager.dispath(EventType.LIFE_CYCLE,e.data);break;case"openBindCard":PageManager.showDlg(DlgCmd.accountInfo);break;case"shareSucess":view.dlg.SharedailyDlg.shareSucess(e.data);break;case"openBindAlipay":PageManager.showDlg(DlgCmd.alipayBind);break;case"saveImage":var p=e.data;Toast.showToast(p?"保存成功":"保存失败");break;case"affcode":console.log("收到App刷新 affcode 消息 affCode = "+e.data),AppData.NATIVE_DATA.affCode=e.data,console.log("AppData.NATIVE_DATA.affCode ="+AppData.NATIVE_DATA.affCode);break;case"popTip":console.log("收到App刷新 popTip 消息 msg = "+e.data),Toast.showToast(e.data);break;case"appNativeData":AppData.NATIVE_DATA=e.data;break;case"appUpate":Common.isUpate=Boolean(e.data)}},g.prototype.clearChild=function(){Dialog.manager.closeAll(),this.sceneLobby&&(this.sceneLobby.destroy(!0),this.sceneLobby=null),this.root_node.destroyChildren(),PageManager.destoryCurrentView()},g.prototype.initLogin=function(){this.loginOut()},g.prototype.initLobby=function(){this.clearChild(),null==this.sceneLobby&&(this.sceneLobby=new LobbyScene,this.sceneLobby.onLoaded(),g.getInstance().getRootNode().addChild(this.sceneLobby))},g.prototype.showCircleLoading=function(a,e){void 0===a&&(a=!0),void 0===e&&(e=.5),a?view.LoadingView.show(e):view.LoadingView.hide()},g.onQuit=function(){SaveManager.getObj().save(SaveManager.KEY_TOKEN,""),g.getInstance().initLogin()},g.obj=null,g}(),AppData=window.sAppData;window.loadJsOver();var lamain=new LayaMain;AppData.IS_NATIVE_APP&&(window.top.receivedMessageFromRN=lamain.onAppPostMessgae);